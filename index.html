<!DOCTYPE html>
<html>

<head>
    <title>Call Arskan</title>
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script src="arskan-library.js"></script>
</head>

<body>
    <div id="container" class="container">

        <iframe style="width:1200px;height:800px;" id="viewer" title="ARSKAN viewer" src="" allowfullscreen=""></iframe>
        
        <div class="hidden obj-template" onclick="displayObject(this.getAttribute('obj-id'))">
            <div class="obj-picture">
                <img src="" alt=""/>
            </div>
            <h3 class="obj-title"></h3>
            <p class="obj-desc"></p>
        </div>

        <script>
            libArskan = new ArskanLib();

            var container = document.getElementById("container");
            var iframe_element = document.getElementById("viewer");
            var objTemplate = document.getElementsByClassName("obj-template")[0];

            libArskan.getAllObjectsFromSilo().then(result => {
                console.log("getAllObjectsFromSilo : ", result);
                for (let obj of result) {
                    var newObj = objTemplate.cloneNode(true);
                    container.appendChild(newObj);

                    newObj.classList.remove("hidden");
                    newObj.classList.remove("obj-template");

                    newObj.setAttribute("obj-id", obj._id);

                    var newPic = newObj.getElementsByClassName("obj-picture")[0];
                    newPic = newPic.getElementsByTagName("img")[0];
                    newPic.setAttribute("src", obj.picture);
                    newPic.setAttribute("alt", obj.title);

                    var title = newObj.getElementsByClassName("obj-title")[0];
                    title.innerText = obj.name;

                    var desc = newObj.getElementsByClassName("obj-desc")[0];
                    desc.innerText = obj.description;
                }
            });

            function displayObject(id) {
                console.log(id);
                libArskan.getEmbedUrlOfObjectFromSilo(id).then(result => {
                    console.log("getEmbedUrlOfObjectFromSilo : ", result);
                    iframe_element.src = "https://viewer.arskan.com" + result.url + "?lang=fr";
                });
            }
        </script>

    </div>

</body>

</html>